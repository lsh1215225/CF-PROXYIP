name: Sync

on:
  schedule:
    - cron: '0 */4 * * *'  
  workflow_dispatch:       # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: æ£€å‡ºmainåˆ†æ”¯
        uses: actions/checkout@v4
        with:
          ref: main

      - name: é…ç½®Gitç”¨æˆ·
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      - name: æ·»åŠ ä¸Šæ¸¸ä»“åº“
        run: git remote add upstream https://github.com/leung7963/CF-PROXYIP.git

      - name: æ‹‰å–ä¸Šæ¸¸ä»£ç 
        run: git fetch upstream main

      - name: å¤‡ä»½æœ¬åœ°é…ç½®æ–‡ä»¶
        run: cp .github/workflows/sync.yml .sync.yml.bak

      - name: å¼ºåˆ¶é‡ç½®åˆ°ä¸Šæ¸¸åˆ†æ”¯
        run: git reset --hard upstream/main

      - name: è¿˜åŸé…ç½®æ–‡ä»¶
        run: |
          mkdir -p .github/workflows
          mv .sync.yml.bak .github/workflows/sync.yml

      - name: æäº¤é…ç½®å˜æ›´
        run: |
          git add .github/workflows/sync.yml
          git commit -m "ğŸ”„ $(TZ='Asia/Shanghai' date +'%m-%d %H:%M') ä¿ç•™æœ¬åœ°sync.ymlé…ç½®" || exit 0   # å¿½ç•¥æ— å˜æ›´æäº¤é”™è¯¯


      - name: å¼ºåˆ¶æ¨é€æ›´æ–°
        run: git push origin main --force
